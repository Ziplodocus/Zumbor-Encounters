var $=Object.defineProperty;var I=(n,e,t)=>e in n?$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>(I(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const c=(n,e=document)=>e.querySelector(n),v=(n,e=document)=>e.querySelectorAll(n),k=(n,e)=>{let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>n(...o),e)}};var d;(function(n){n.SUCCESS="Success",n.FAIL="Fail"})(d||(d={}));var h;(function(n){n.DAMAGE="Damage",n.HEAL="Heal",n.NONE="No effect",n.CHARISMA="Charisma",n.STRENGTH="Strength",n.AGILITY="Agility",n.WISDOM="Wisdom"})(h||(h={}));var p;(function(n){n.STRENGTH="Strength",n.WISDOM="Wisdom",n.AGILITY="Agility",n.CHARISMA="Charisma"})(p||(p={}));function H(n){const e=n;try{const{title:t,text:o,options:r}=e;if(e.color&&typeof e.color!="string")return new Error("Color is not a string");for(let i in[t,o])if(typeof i!="string")return new Error(i+" is not a string");if(Object.keys(r).length<=0)return new Error("Please add at least one option!");if(Object.keys(r).length>4)return new Error("That's too many options!");for(const i in r){const{threshold:a,stat:u,Success:l,Fail:C}=r[i];if(typeof a!="number")return new Error(a+" is not a number");if(!Object.values(p).includes(u))return new Error(u+" is not a valid Attribute");for(const T of[l,C]){const{type:E,title:A,text:O,effect:w,potency:g}=T;for(let y in[A,O])if(typeof y!="string")return new Error(y+" is not a string");if(!Object.values(d).includes(E))return new Error(E+" is not a valid EncounterResult");if(!Object.values(h).includes(w))return new Error(w+" is not a valid PlayerEffect");if(typeof g!="number")return new Error(g+" is not a number")}}return e}catch(t){return t instanceof Error?t:typeof t=="string"?new Error(t):(console.error(t),new Error("Unkown Error"))}}class M{constructor(e){s(this,"form");s(this,"namer");s(this,"options");s(this,"submit");s(this,"template");s(this,"add",()=>{var r;if(!this.namer.checkValidity())return this.error(new Error("Please add a label for the option"));const e=this.namer.value;if(this.options.size===4)return this.error(new Error("You've added the maximum of 4 options"));if(this.options.has(e))return this.error(new Error("There is already an option with that name"));const t=this.template.cloneNode(!0);t.name=e;const o=c("legend span",t);if(!o)return this.error(new Error("Option template has no legend"));if(o.textContent=e,this.options.add(t.name),this.form.appendChild(t),this.namer.value="",(r=c("[data-action=removeOption]",t))==null||r.addEventListener("click",()=>{this.form.removeChild(t),this.options.delete(e),this.notice(`Removed ${e} option`)}),this.options.size!==4)return this.notice(`Added ${e} option`)});s(this,"reset",()=>{v("fieldset[data-option]",this.form).forEach(e=>e.remove())});s(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});s(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});this.form=e,this.template=this.getTemplate(),this.namer=this.getNamer(),this.options=new Set,this.submit=this.getSubmit(),this.initStats(),this.initEffects(),this.namer.addEventListener("keyup",t=>{t.key==="Enter"&&(t.preventDefault(),this.add())}),this.submit.addEventListener("click",this.add)}initStats(){const e=c("[name=stat]",this.template);if(!(e instanceof HTMLSelectElement))throw new Error("[name=stat] is not a select element");for(const t of Object.values(p)){const o=document.createElement("option");o.value=t,o.innerText=t,e.appendChild(o)}}initEffects(){const e=v("select[name=effect]",this.template);if(e.length!==2)throw new Error("Missing two select[name=effect]");e.forEach(t=>{for(const o of Object.values(h)){const r=document.createElement("option");r.value=o,r.innerText=o,t.appendChild(r)}})}getTemplate(){let e=c(":scope [data-option-template]",this.form);if(!(e instanceof HTMLTemplateElement))throw new Error("No template element with data-option-template attribute");if(e=e.content.firstElementChild,!(e instanceof HTMLFieldSetElement))throw new Error("Child element of the template is not a fieldset element");return e}getNamer(){const e=c("[data-option-name]",this.form);if(!(e instanceof HTMLInputElement))throw new Error("[data-option-name] is not an input element");return e}getSubmit(){const e=c("[data-action=addOption]",this.form);if(!(e instanceof HTMLButtonElement))throw new Error("[data-action=addOption] is not a button element");return e}}function j(n){return n>=55296&&n<=56319}function N(n){return n>=56320&&n<=57343}var F=function(e,t,o){if(typeof t!="string")throw new Error("Input must be string");for(var r=t.length,i=0,a,u,l=0;l<r;l+=1){if(a=t.charCodeAt(l),u=t[l],j(a)&&N(t.charCodeAt(l+1))&&(l+=1,u+=t[l]),i+=e(u),i===o)return t.slice(0,l+1);if(i>o)return t.slice(0,l-u.length+1)}return t};function R(n){return n>=55296&&n<=56319}function z(n){return n>=56320&&n<=57343}var D=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,o=0,r=null,i=null,a=0;a<t;a++)r=e.charCodeAt(a),z(r)?i!=null&&R(i)?o+=1:o+=3:r<=127?o+=1:r>=128&&r<=2047?o+=2:r>=2048&&r<=65535&&(o+=3),i=r;return o},G=F,U=D,W=G.bind(null,U),q=W,B=/[\/\?<>\\:\*\|"]/g,Y=/[\x00-\x1f\x80-\x9f]/g,V=/^\.+$/,J=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,K=/[\. ]+$/;function b(n,e){if(typeof n!="string")throw new Error("Input must be string");var t=n.replace(B,e).replace(Y,e).replace(V,e).replace(J,e).replace(K,e);return q(t,255)}var P=function(n,e){var t=e&&e.replacement||"",o=b(n,t);return t===""?o:b(o,"")};class Q{constructor(e,t){s(this,"form");s(this,"options");s(this,"wrap");s(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});s(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});s(this,"jsonify",(e=this.wrap)=>{let t={};const o=v(":scope > label [name], :scope > fieldset",e);for(const r of Array.from(o)){if(!r.checkValidity())return new Error(`The ${(r==null?void 0:r.placeholder)||r.name} field is invalid...`);if(r instanceof HTMLFieldSetElement){const i=this.jsonify(r);if(i instanceof Error)return i;t[r.name]=i}else t[r.name]=r.type==="number"?+r.value:r.value;(r.name===d.SUCCESS||r.name===d.FAIL)&&(t[r.name].type=r.name)}return t});s(this,"reset",async()=>{this.options.reset(),this.form.reset()});s(this,"submit",async()=>{let e=this.jsonify();if(e instanceof Error)return this.error(e);const t=H(e);if(t instanceof Error)return this.error(t);const o=P(t.title);this.form.dispatchEvent(new CustomEvent("zubmit",{detail:{filename:o,data:t}}))});this.form=t,this.wrap=c("fieldset",t);let o=c("[name=options]",t);if(!(o instanceof HTMLFieldSetElement))throw new Error("[name=options] is not a fieldset element");this.options=new M(o),e.addEventListener("click",this.submit),this.options.form.addEventListener("err",r=>this.error(r.detail)),this.options.form.addEventListener("notice",r=>this.notice(r.detail))}}class X extends HTMLElement{constructor(){super();s(this,"clear",k(()=>{this.removeAttribute("active"),this.removeAttribute("invalid")},4e3))}notify(t){this.textContent=t,this.setAttribute("active",""),this.removeAttribute("invalid"),this.clear()}error(t){this.notify(t),this.setAttribute("invalid","")}}const S="ziplod-assets",L="zumbor%2Fencounters%2F",x="https://firebasestorage.googleapis.com";async function Z(n,e){const t=await fetch(`${x}/v0/b/${S}/o/${L}${n}.json?key=${e}`);return t.status===200?!0:t.status===404?!1:t.status===403?new Error("Incorrect password"):(console.error(t),new Error("Something has gone wrong checking file existence"))}async function _(n,e,t){const o=await fetch(`${x}/v0/b/${S}/o/${L}${n}.json?key=${t}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return o.status===200?!0:o.status===403?new Error("Incorrect password"):(console.error(o),new Error("Something went wrong with the upload"))}customElements.define("notice-strip",X);const f=c("notice-strip"),ee=c("[data-auth-token]"),m=c("form[data-encounter-form]");new Q(c("[data-submit]"),m);m.addEventListener("err",n=>{f.error(n.detail.message)});m.addEventListener("notice",n=>{f.notify(n.detail)});m.addEventListener("zubmit",async n=>{const{filename:e,data:t}=n.detail,o=ee.value,r=await Z(e,o);if(r===!0)return f.error(`Encounter ${t.title} already exists!`);if(r instanceof Error)return f.error(r.message);const i=await _(e,t,o);i instanceof Error&&f.error(i.message),m.reset(),f.notify(`Encounter ${t.title} has been added`)});
