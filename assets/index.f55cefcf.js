var R=Object.defineProperty;var F=(n,e,t)=>e in n?R(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(F(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const c=(n,e=document)=>e.querySelector(n),d=(n,e=document)=>e.querySelectorAll(n),H=(n,e)=>{let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>n(...o),e)}};function j(n){console.log("Setting required"),n.setAttribute("required","")}function k(n){console.log("Setting not required"),n.removeAttribute("required")}var h;(function(n){n.SUCCESS="Success",n.FAIL="Fail"})(h||(h={}));var v;(function(n){n.CHARISMA="Charisma",n.STRENGTH="Strength",n.AGILITY="Agility",n.WISDOM="Wisdom",n.POISON="Poisoned",n.REGENERATE="Regeneration"})(v||(v={}));var w;(function(n){n.DAMAGE="Damage",n.HEAL="Heal",n.CHARISMA="Charisma",n.STRENGTH="Strength",n.AGILITY="Agility",n.WISDOM="Wisdom"})(w||(w={}));var g;(function(n){n.BUFF="Buff",n.DEBUFF="Debuff"})(g||(g={}));var b;(function(n){n.STRENGTH="Strength",n.WISDOM="Wisdom",n.AGILITY="Agility",n.CHARISMA="Charisma"})(b||(b={}));function N(n){const e=n;try{const{title:t,text:o,options:r}=e;if(e.color&&typeof e.color!="string")return new Error("Color is not a string");for(let i in[t,o])if(typeof i!="string")return new Error(i+" is not a string");if(Object.keys(r).length<=0)return new Error("Please add at least one option!");if(Object.keys(r).length>4)return new Error("That's too many options!");for(const i in r){const{threshold:s,stat:f,Success:l,Fail:C}=r[i];if(typeof s!="number")return new Error(s+" is not a number");if(!Object.values(b).includes(f))return new Error(f+" is not a valid Attribute");for(const I of[l,C]){const{type:y,title:O,text:$,baseEffect:p,additionalEffect:u}=I;for(let S in[O,$])if(typeof S!="string")return new Error(S+" is not a string");if(p){if(!Object.values(h).includes(y))return new Error(y+" is not a valid EncounterResult");if(!Object.values(w).includes(p.name))return new Error(p.name+" is not a valid effect");if(typeof p.potency!="number")return new Error(p.potency+" is not a number")}if(u){if(!Object.values(v).includes(u.name))return new Error(u.name+" is not a valid effect");if(typeof u.potency!="number")return new Error(u.potency+" is not a number");if(typeof u.duration!="number")return new Error(u.duration+" is not a number")}}}return e}catch(t){return t instanceof Error?t:typeof t=="string"?new Error(t):(console.error(t),new Error("Unkown Error"))}}class M{constructor(e){a(this,"form");a(this,"namer");a(this,"options");a(this,"submit");a(this,"template");a(this,"add",()=>{var i;if(!this.namer.checkValidity())return this.error(new Error("Please add a label for the option"));const e=this.namer.value;if(this.options.size===4)return this.error(new Error("You've added the maximum of 4 options"));if(this.options.has(e))return this.error(new Error("There is already an option with that name"));const t=this.template.cloneNode(!0);t.name=e;const o=c("legend span",t);if(!o)return this.error(new Error("Option template has no legend"));o.textContent=e,this.options.add(t.name),this.form.appendChild(t),this.namer.value="",(i=c("[data-action=removeOption]",t))==null||i.addEventListener("click",()=>{this.form.removeChild(t),this.options.delete(e),this.notice(`Removed ${e} option`)}),d("select[name=name]",t).forEach(s=>{const f=s.closest("fieldset"),l=d("[name]",f);s.addEventListener("input",()=>{s.value!==""?l.forEach(j):l.forEach(k)})}),this.notice(`Added ${e} option`)});a(this,"reset",()=>{d("fieldset[data-option]",this.form).forEach(e=>e.remove())});a(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});a(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});this.form=e,this.template=this.getTemplate(),this.namer=this.getNamer(),this.options=new Set,this.submit=this.getSubmit(),this.initStats(),this.initBaseEffects(),this.initAdditionalEffects(),this.namer.addEventListener("keyup",t=>{t.key==="Enter"&&(t.preventDefault(),this.add())}),this.submit.addEventListener("click",this.add)}initStats(){const e=c("[name=stat]",this.template);if(!(e instanceof HTMLSelectElement))throw new Error("[name=stat] is not a select element");for(const t of Object.values(b)){const o=document.createElement("option");o.value=t,o.innerText=t,e.appendChild(o)}}initBaseEffects(){d("fieldset[name=baseEffect]",this.template).forEach(t=>{const o=c("select[name=name]",t);if(!o)throw new Error("No name input in baseEffect fieldset");for(const r of Object.values(w)){const i=document.createElement("option");i.value=r,i.innerText=r,o.appendChild(i)}})}initAdditionalEffects(){d("fieldset[name=additionalEffect]",this.template).forEach(t=>{const o=c("select[name=name]",t);if(!o)throw new Error("No name input in baseEffect fieldset");for(const i of Object.values(v)){const s=document.createElement("option");s.value=i,s.innerText=i,o.appendChild(s)}const r=c("select[name=type]",t);if(!r)throw new Error("No type input in baseEffect fieldset");for(const i of Object.values(g)){const s=document.createElement("option");s.value=i,s.innerText=i,r.appendChild(s)}})}getTemplate(){let e=c(":scope [data-option-template]",this.form);if(!(e instanceof HTMLTemplateElement))throw new Error("No template element with data-option-template attribute");if(e=e.content.firstElementChild,!(e instanceof HTMLFieldSetElement))throw new Error("Child element of the template is not a fieldset element");return e}getNamer(){const e=c("[data-option-name]",this.form);if(!(e instanceof HTMLInputElement))throw new Error("[data-option-name] is not an input element");return e}getSubmit(){const e=c("[data-action=addOption]",this.form);if(!(e instanceof HTMLButtonElement))throw new Error("[data-action=addOption] is not a button element");return e}}function G(n){return n>=55296&&n<=56319}function D(n){return n>=56320&&n<=57343}var q=function(e,t,o){if(typeof t!="string")throw new Error("Input must be string");for(var r=t.length,i=0,s,f,l=0;l<r;l+=1){if(s=t.charCodeAt(l),f=t[l],G(s)&&D(t.charCodeAt(l+1))&&(l+=1,f+=t[l]),i+=e(f),i===o)return t.slice(0,l+1);if(i>o)return t.slice(0,l-f.length+1)}return t};function z(n){return n>=55296&&n<=56319}function B(n){return n>=56320&&n<=57343}var P=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,o=0,r=null,i=null,s=0;s<t;s++)r=e.charCodeAt(s),B(r)?i!=null&&z(i)?o+=1:o+=3:r<=127?o+=1:r>=128&&r<=2047?o+=2:r>=2048&&r<=65535&&(o+=3),i=r;return o},U=q,W=P,Y=U.bind(null,W),V=Y,J=/[\/\?<>\\:\*\|"]/g,Q=/[\x00-\x1f\x80-\x9f]/g,X=/^\.+$/,Z=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,_=/[\. ]+$/;function A(n,e){if(typeof n!="string")throw new Error("Input must be string");var t=n.replace(J,e).replace(Q,e).replace(X,e).replace(Z,e).replace(_,e);return V(t,255)}var K=function(n,e){var t=e&&e.replacement||"",o=A(n,t);return t===""?o:A(o,"")};class ee{constructor(e,t){a(this,"form");a(this,"options");a(this,"wrap");a(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});a(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});a(this,"jsonify",(e=this.wrap)=>{let t={};const o=d(":scope > label [name], :scope > fieldset",e);for(const r of Array.from(o)){if(!r.checkValidity())return new Error(`The ${(r==null?void 0:r.placeholder)||r.name} field is invalid...`);if(r instanceof HTMLFieldSetElement){if((r.name==="baseEffect"||r.name==="additionalEffect")&&c("select[name=name]",r).value===""){t[r.name]=void 0;continue}const i=this.jsonify(r);if(i instanceof Error)return i;t[r.name]=i}else t[r.name]=r.type==="number"?+r.value:r.value;(r.name===h.SUCCESS||r.name===h.FAIL)&&(t[r.name].type=r.name)}return t});a(this,"reset",async()=>{this.options.reset(),this.form.reset()});a(this,"submit",async()=>{let e=this.jsonify();if(e instanceof Error)return this.error(e);console.log(e);const t=N(e);if(t instanceof Error)return this.error(t);console.log(t);const o=K(t.title);this.form.dispatchEvent(new CustomEvent("zubmit",{detail:{filename:o,data:t}}))});this.form=t,this.wrap=c("fieldset",t);let o=c("[name=options]",t);if(!(o instanceof HTMLFieldSetElement))throw new Error("[name=options] is not a fieldset element");this.options=new M(o),e.addEventListener("click",this.submit),this.options.form.addEventListener("err",r=>this.error(r.detail)),this.options.form.addEventListener("notice",r=>this.notice(r.detail))}}class te extends HTMLElement{constructor(){super();a(this,"clear",H(()=>{this.removeAttribute("active"),this.removeAttribute("invalid")},4e3))}notify(t){this.textContent=t,this.setAttribute("active",""),this.removeAttribute("invalid"),this.clear()}error(t){this.notify(t),this.setAttribute("invalid","")}}const T="ziplod-assets",x="zumbor%2Fencounters%2F",L="https://firebasestorage.googleapis.com";async function ne(n,e){const t=await fetch(`${L}/v0/b/${T}/o/${x}${n}.json?key=${e}`);return t.status===200?!0:t.status===404?!1:t.status===403?new Error("Incorrect password"):(console.error(t),new Error("Something has gone wrong checking file existence"))}async function re(n,e,t){const o=await fetch(`${L}/v0/b/${T}/o/${x}${n}.json?key=${t}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});return o.status===200?!0:o.status===403?new Error("Incorrect password"):(console.error(o),new Error("Something went wrong with the upload"))}customElements.define("notice-strip",te);const m=c("notice-strip"),oe=c("[data-auth-token]"),E=c("form[data-encounter-form]");new ee(c("[data-submit]"),E);E.addEventListener("err",n=>{m.error(n.detail.message)});E.addEventListener("notice",n=>{m.notify(n.detail)});E.addEventListener("zubmit",async n=>{const{filename:e,data:t}=n.detail,o=oe.value,r=await ne(e,o);if(r===!0)return m.error(`Encounter ${t.title} already exists!`);if(r instanceof Error)return m.error(r.message);const i=await re(e,t,o);i instanceof Error&&m.error(i.message),E.reset(),m.notify(`Encounter ${t.title} has been added`)});
