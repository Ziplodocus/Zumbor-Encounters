var O=Object.defineProperty;var k=(r,e,t)=>e in r?O(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>(k(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const l=(r,e=document)=>e.querySelector(r),y=(r,e=document)=>e.querySelectorAll(r),I=(r,e)=>{let t;return(...o)=>{clearTimeout(t),t=setTimeout(()=>r(...o),e)}};function H(r){return r[0].toUpperCase()+r.slice(1)}var b=(r=>(r.SUCCESS="success",r.FAIL="fail",r))(b||{}),m=(r=>(r.DAMAGE="damage",r.HEAL="heal",r.NONE="no effect",r.CHARISMA="charisma",r))(m||{}),h=(r=>(r.Strength="strength",r.Wisdom="wisdom",r.Agility="agility",r.Charisma="charisma",r))(h||{});function M(r){const e=r;try{const{title:t,text:o,options:n}=e;if(e.color&&typeof e.color!="string")return new Error("Color is not a string");for(let i in[t,o])if(typeof i!="string")return new Error(i+" is not a string");for(const i in n){const{threshold:a,stat:u,success:c,fail:C}=n[i];if(typeof a!="number")return new Error(a+" is not a string");if(!Object.values(h).includes(u))return new Error(u+" is not a valid Attribute");for(const $ of[c,C]){const{type:p,title:T,text:A,effect:v,value:E}=$;for(let w in[T,A])if(typeof w!="string")return new Error(w+" is not a string");return Object.values(b).includes(p)?Object.values(m).includes(v)?typeof E!="number"?new Error(E+" is not a number"):new Error:new Error(v+" is not a valid PlayerEffect"):new Error(p+" is not a valid EncounterResult")}}return e}catch(t){return t instanceof Error?t:typeof t=="string"?new Error(t):(console.error(t),new Error("Unkown Error"))}}class N{constructor(e){s(this,"form");s(this,"namer");s(this,"options");s(this,"submit");s(this,"template");s(this,"add",()=>{if(!this.namer.checkValidity())return this.error(new Error("Please add a label for the option"));const e=this.namer.value;if(this.options.size===4)return this.error(new Error("You've added the maximum of 4 options"));if(this.options.has(e))return this.error(new Error("There is already an option with that name"));const t=this.template.cloneNode(!0);t.name=e;const o=l("legend",t);if(!o)return this.error(new Error("Option template has no legend"));if(o.textContent=e,this.options.add(t.name),this.form.appendChild(t),this.namer.value="",this.options.size!==4)return this.notice(`Added ${e} option`)});s(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});s(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});this.form=e,this.template=this.getTemplate(),this.namer=this.getNamer(),this.options=new Set,this.submit=this.getSubmit(),this.initStats(),this.initEffects(),this.namer.addEventListener("keyup",t=>t.key==="Enter"&&this.add()),this.submit.addEventListener("click",this.add)}initStats(){const e=l("[name=stat]",this.template);if(!(e instanceof HTMLSelectElement))throw new Error("[name=stat] is not a select element");for(const[t,o]of Object.entries(h)){const n=document.createElement("option");n.value=o,n.innerText=t,e.appendChild(n)}}initEffects(){const e=y("select[name=effect]",this.template);if(e.length!==2)throw new Error("Missing two select[name=effect]");e.forEach(t=>{for(const[o,n]of Object.entries(m)){const i=document.createElement("option");i.value=o,i.innerText=H(n),t.appendChild(i)}})}getTemplate(){let e=l(":scope [data-option]",this.form);if(!(e instanceof HTMLTemplateElement))throw new Error("No template element with data-option attribute");if(e=e.content.firstElementChild,!(e instanceof HTMLFieldSetElement))throw new Error("Child element of the template is not a fieldset element");return e}getNamer(){const e=l("[data-option-name]",this.form);if(!(e instanceof HTMLInputElement))throw new Error("[data-option-name] is not an input element");return e}getSubmit(){const e=l("[data-action=addOption]",this.form);if(!(e instanceof HTMLButtonElement))throw new Error("[data-action=addOption] is not a button element");return e}}function j(r){return r>=55296&&r<=56319}function F(r){return r>=56320&&r<=57343}var z=function(e,t,o){if(typeof t!="string")throw new Error("Input must be string");for(var n=t.length,i=0,a,u,c=0;c<n;c+=1){if(a=t.charCodeAt(c),u=t[c],j(a)&&F(t.charCodeAt(c+1))&&(c+=1,u+=t[c]),i+=e(u),i===o)return t.slice(0,c+1);if(i>o)return t.slice(0,c-u.length+1)}return t};function R(r){return r>=55296&&r<=56319}function U(r){return r>=56320&&r<=57343}var q=function(e){if(typeof e!="string")throw new Error("Input must be string");for(var t=e.length,o=0,n=null,i=null,a=0;a<t;a++)n=e.charCodeAt(a),U(n)?i!=null&&R(i)?o+=1:o+=3:n<=127?o+=1:n>=128&&n<=2047?o+=2:n>=2048&&n<=65535&&(o+=3),i=n;return o},B=z,D=q,V=B.bind(null,D),G=V,J=/[\/\?<>\\:\*\|"]/g,K=/[\x00-\x1f\x80-\x9f]/g,P=/^\.+$/,W=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,Y=/[\. ]+$/;function g(r,e){if(typeof r!="string")throw new Error("Input must be string");var t=r.replace(J,e).replace(K,e).replace(P,e).replace(W,e).replace(Y,e);return G(t,255)}var Q=function(r,e){var t=e&&e.replacement||"",o=g(r,t);return t===""?o:g(o,"")};class X{constructor(e,t){s(this,"form");s(this,"options");s(this,"wrap");s(this,"error",e=>{this.form.dispatchEvent(new CustomEvent("err",{detail:e}))});s(this,"notice",e=>{this.form.dispatchEvent(new CustomEvent("notice",{detail:e}))});s(this,"jsonify",(e=this.wrap)=>{let t={};const o=y(":scope > label [name], :scope > fieldset",e);for(const n of Array.from(o)){if(!n.checkValidity())return new Error(`The ${n.name} field is invalid...`);t[n.name]=n instanceof HTMLFieldSetElement?this.jsonify(n):n.type==="number"?+n.value:n.value,(n.name==="success"||n.name==="fail")&&(t[n.name].type=n.name)}return t});s(this,"submit",async()=>{let e=this.jsonify();if(console.log(e),e instanceof Error)return this.error(e);const t=M(e);if(t instanceof Error)return this.error(t);const o=Q(t.title);this.form.dispatchEvent(new CustomEvent("zubmit",{detail:{filename:o,data:t}}))});this.form=t,this.wrap=l("fieldset",t);let o=l("[name=options]",t);if(!(o instanceof HTMLFieldSetElement))throw new Error("[name=options] is not a fieldset element");this.options=new N(o),e.addEventListener("click",this.submit),this.options.form.addEventListener("err",n=>this.error(n.detail)),this.options.form.addEventListener("notice",n=>this.notice(n.detail))}}class Z extends HTMLElement{constructor(){super();s(this,"clear",I(()=>{this.removeAttribute("active"),this.removeAttribute("invalid")},4e3))}notify(t){this.textContent=t,this.setAttribute("active",""),this.removeAttribute("invalid"),this.clear()}error(t){this.notify(t),this.setAttribute("invalid","")}}const x="ziplod-assets",L="zumbor%2Fencounters%2F",S="https://firebasestorage.googleapis.com";async function _(r,e){const t=await fetch(`${S}/v0/b/${x}/o/${L}${r}.json?key=${e}`);return t.status===200?!0:t.status===404?!1:t.status===403?new Error("Incorrect password"):(console.error(t),new Error("Something has gone wrong checking file existence"))}async function ee(r,e,t){const o=await fetch(`${S}/v0/b/${x}/o/${L}${r}.json?key=${t}`,{method:"POST",body:JSON.stringify(e)});return o.status===200?!0:o.status===403?new Error("Incorrect password"):(console.error(o),new Error("Something went wrong with the upload"))}customElements.define("notice-strip",Z);const f=l("notice-strip"),te=l("[data-auth-token]"),d=l("form[data-encounter-form]");new X(l("[data-submit]"),d);d.addEventListener("err",r=>{f.error(r.detail.message)});d.addEventListener("notice",r=>{f.notify(r.detail)});d.addEventListener("zubmit",async r=>{const{filename:e,data:t}=r.detail,o=te.value,n=await _(e,o);if(n===!0)return f.error(`Encounter ${t.title} already exists!`);if(n instanceof Error)return f.error(n.message);const i=await ee(e,t,o);i instanceof Error&&f.error(i.message),f.notify(`Encounter ${t.title} has been added`)});
